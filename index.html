<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #0b1d38;
            --secondary-color: #1a2b4a;
            --accent-color: #00c3ff;
            --text-color: #ffffff;
            --danger-color: #ff4d4d;
            --success-color: #4dff4d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            color: var(--text-color);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .sidebar-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sidebar-header h2 i {
            color: var(--accent-color);
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 5px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-color);
            text-decoration: none;
            transition: all 0.3s;
            gap: 10px;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(0, 195, 255, 0.1);
            border-left: 3px solid var(--accent-color);
        }
        
        .sidebar-menu a i {
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .header h1 {
            font-size: 24px;
            color: var(--primary-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .card-header h2 {
            font-size: 18px;
            color: var(--primary-color);
        }
        
        .search-bar {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-bar input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            outline: none;
        }
        
        .search-bar button {
            padding: 10px 15px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        table tr:hover {
            background-color: #f8f9fa;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .badge-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .btn {
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn i {
            margin-right: 5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 600px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--primary-color);
        }
        
        .modal-header .close {
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .form-group textarea {
            min-height: 100px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-card i {
            font-size: 30px;
            margin-bottom: 10px;
            color: var(--accent-color);
        }
        
        .stat-card h3 {
            font-size: 24px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .stat-card p {
            color: #666;
            font-size: 14px;
        }
        
        .chart-container {
            height: 300px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 8px 12px;
            margin: 0 5px;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .pagination button.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: var(--accent-color);
            color: var(--accent-color);
            font-weight: 500;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Login Modal Styles */
        .login-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .login-content {
            background-color: white;
            border-radius: 10px;
            width: 400px;
            max-width: 90%;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .login-header h2 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .login-header p {
            color: #666;
        }
        
        .login-form .form-group {
            margin-bottom: 20px;
        }
        
        .login-form .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
        }
        
        .login-form .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .login-form .form-group input:focus {
            border-color: var(--accent-color);
            outline: none;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .login-btn:hover {
            background-color: #00a8e0;
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
        
        .error-message {
            color: var(--danger-color);
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }
        
        .admin-panel {
            display: none;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .deleted-users-table {
            margin-top: 20px;
        }
        
        .restore-btn {
            background-color: #28a745;
            color: white;
        }
        
        .time-period-selector {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .time-period-selector button {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .time-period-selector button.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar-header h2 span, .sidebar-menu a span {
                display: none;
            }
            
            .sidebar-menu a {
                justify-content: center;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .login-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="login-modal" id="login-modal">
        <div class="login-content">
            <div class="login-header">
                <h2><i class="fas fa-shield-alt"></i> Admin Login</h2>
                <p>Please enter your credentials to access the admin panel</p>
            </div>
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="admin-name">Admin Name</label>
                    <input type="text" id="admin-name" placeholder="Enter your admin name" required>
                </div>
                <div class="form-group">
                    <label for="admin-password">Password</label>
                    <input type="password" id="admin-password" placeholder="Enter your password" required>
                </div>
                <div class="form-group">
                    <input type="checkbox" id="remember-me">
                    <label for="remember-me" style="display: inline; margin-left: 5px;">Remember me</label>
                </div>
                <button type="submit" class="login-btn">Login</button>
                <div class="error-message" id="login-error"></div>
            </form>
            <div class="login-footer">
                <p>Restricted access. Unauthorized entry prohibited.</p>
            </div>
        </div>
    </div>
    
    <!-- Admin Panel (hidden until login) -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-container">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2><i class="fas fa-shield-alt"></i> <span>Admin Panel</span></h2>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                    <li><a href="#" data-page="users"><i class="fas fa-users"></i> <span>Users</span></a></li>
                    <li><a href="#" data-page="transactions"><i class="fas fa-wallet"></i> <span>Transactions</span></a></li>
                    <li><a href="#" data-page="withdrawals"><i class="fas fa-money-bill-wave"></i> <span>Withdrawals</span></a></li>
                    <li><a href="#" data-page="analytics"><i class="fas fa-chart-line"></i> <span>Analytics</span></a></li>
                    <li><a href="#" data-page="settings"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
                    <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
                </ul>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Dashboard Page -->
                <div class="page active" id="dashboard-page">
                    <div class="header">
                        <h1>Dashboard Overview</h1>
                        <div class="user-info">
                            <img src="https://www.citypng.com/public/uploads/preview/hd-man-user-illustration-icon-transparent-png-701751694974843ybexneueic.png" alt="Admin">
                            <span id="admin-display-name">Admin</span>
                        </div>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="stats-container">
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <h3 id="total-users">0</h3>
                            <p>Total Users</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-wallet"></i>
                            <h3 id="total-balance">₹0</h3>
                            <p>Total Balance</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3 id="total-withdrawals">₹0</h3>
                            <p>Total Withdrawals</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-chart-line"></i>
                            <h3 id="active-today">0</h3>
                            <p>Active Today</p>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Quick Actions</h2>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" id="add-user-btn"><i class="fas fa-plus"></i> Add User</button>
                            <button class="btn btn-success" id="view-deleted-btn"><i class="fas fa-trash-restore"></i> View Deleted Users</button>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h2>Recent Activity</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="recent-activity-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Users Page -->
                <div class="page" id="users-page">
                    <div class="header">
                        <h1>User Management</h1>
                        <div class="user-info">
                            <img src="https://www.citypng.com/public/uploads/preview/hd-man-user-illustration-icon-transparent-png-701751694974843ybexneueic.png" alt="Admin">
                            <span id="admin-display-name-users">Admin</span>
                        </div>
                    </div>
                    
                    <!-- Search and Filter -->
                    <div class="card">
                        <div class="search-bar">
                            <input type="text" id="user-search" placeholder="Search users by ID, name...">
                            <button id="search-btn"><i class="fas fa-search"></i> Search</button>
                        </div>
                    </div>
                    
                    <!-- Users Table -->
                    <div class="card">
                        <div class="card-header">
                            <h2>All Users</h2>
                            <button class="btn btn-primary" id="add-user-btn-users"><i class="fas fa-plus"></i> Add User</button>
                        </div>
                        <table id="users-table">
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>Nickname</th>
                                    <th>Balance</th>
                                    <th>Withdrawable</th>
                                    <th>Last Active</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                        <div class="pagination">
                            <button id="prev-page"><i class="fas fa-chevron-left"></i></button>
                            <span id="page-info">Page 1 of 1</span>
                            <button id="next-page"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
                
                <!-- Transactions Page -->
                <div class="page" id="transactions-page">
                    <div class="header">
                        <h1>Transaction Management</h1>
                        <div class="user-info">
                            <img src="https://www.citypng.com/public/uploads/preview/hd-man-user-illustration-icon-transparent-png-701751694974843ybexneueic.png" alt="Admin">
                            <span>Admin</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>All Transactions</h2>
                        </div>
                        <div class="search-bar">
                            <input type="text" id="transaction-search" placeholder="Search transactions...">
                            <button id="transaction-search-btn"><i class="fas fa-search"></i> Search</button>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>User ID</th>
                                    <th>Amount</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody id="all-transactions-list">
                                <!-- All transactions will be loaded here -->
                            </tbody>
                        </table>
                        <div class="pagination">
                            <button id="transactions-prev-page"><i class="fas fa-chevron-left"></i></button>
                            <span id="transactions-page-info">Page 1 of 1</span>
                            <button id="transactions-next-page"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
                
                <!-- Withdrawals Page -->
                <div class="page" id="withdrawals-page">
                    <div class="header">
                        <h1>Withdrawal Management</h1>
                        <div class="user-info">
                            <img src="https://www.citypng.com/public/uploads/preview/hd-man-user-illustration-icon-transparent-png-701751694974843ybexneueic.png" alt="Admin">
                            <span>Admin</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>All Withdrawals</h2>
                        </div>
                        <div class="tabs">
                            <div class="tab active" data-tab="pending-withdrawals">Pending</div>
                            <div class="tab" data-tab="completed-withdrawals">Completed</div>
                            <div class="tab" data-tab="rejected-withdrawals">Rejected</div>
                        </div>
                        
                        <div class="search-bar">
                            <input type="text" id="withdrawal-search" placeholder="Search withdrawals...">
                            <button id="withdrawal-search-btn"><i class="fas fa-search"></i> Search</button>
                        </div>
                        
                        <div class="tab-content active" id="pending-withdrawals-tab">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>User ID</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Account Details</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-withdrawals-list">
                                    <!-- Pending withdrawals will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="tab-content" id="completed-withdrawals-tab">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>User ID</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Processed At</th>
                                    </tr>
                                </thead>
                                <tbody id="completed-withdrawals-list">
                                    <!-- Completed withdrawals will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="tab-content" id="rejected-withdrawals-tab">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>User ID</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Rejected At</th>
                                    </tr>
                                </thead>
                                <tbody id="rejected-withdrawals-list">
                                    <!-- Rejected withdrawals will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination">
                            <button id="withdrawals-prev-page"><i class="fas fa-chevron-left"></i></button>
                            <span id="withdrawals-page-info">Page 1 of 1</span>
                            <button id="withdrawals-next-page"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Page -->
                <div class="page" id="analytics-page">
                    <div class="header">
                        <h1>System Analytics</h1>
                        <div class="user-info">
                            <img src="https://www.citypng.com/public/uploads/preview/hd-man-user-illustration-icon-transparent-png-701751694974843ybexneueic.png" alt="Admin">
                            <span>Admin</span>
                        </div>
                    </div>
                    
                    <div class="time-period-selector">
                        <button class="active" data-period="7">Last 7 Days</button>
                        <button data-period="30">Last 30 Days</button>
                        <button data-period="90">Last 90 Days</button>
                        <button data-period="365">Last Year</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>User Growth</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="user-growth-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>Active Users</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="active-users-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>Financial Metrics</h2>
                        </div>
                        <div class="chart-container">
                            <canvas id="financial-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Page -->
                <div class="page" id="settings-page">
                    <div class="header">
                        <h1>System Settings</h1>
                        <div class="user-info">
                            <img src="https://www.citypng.com/public/uploads/preview/hd-man-user-illustration-icon-transparent-png-701751694974843ybexneueic.png" alt="Admin">
                            <span>Admin</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>Admin Account Settings</h2>
                        </div>
                        <div class="form-group">
                            <label>Admin Username</label>
                            <input type="text" id="admin-username" value="JBR">
                        </div>
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" id="admin-new-password" placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" id="admin-confirm-password" placeholder="Confirm new password">
                        </div>
                        <button class="btn btn-primary" id="save-admin-settings">Save Changes</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>Deleted Users</h2>
                        </div>
                        <table class="deleted-users-table">
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>Nickname</th>
                                    <th>Deleted At</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="deleted-users-list">
                                <!-- Deleted users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User Detail Modal -->
        <div class="modal" id="user-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>User Details</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="tabs">
                        <div class="tab active" data-tab="basic">Basic Info</div>
                        <div class="tab" data-tab="transactions">Transactions</div>
                        <div class="tab" data-tab="withdrawals">Withdrawals</div>
                        <div class="tab" data-tab="investments">Investments</div>
                    </div>
                    
                    <div class="tab-content active" id="basic-tab">
                        <div class="form-group">
                            <label>User ID</label>
                            <input type="text" id="modal-user-id" readonly>
                        </div>
                        <div class="form-group">
                            <label>Profile Picture URL</label>
                            <input type="text" id="modal-profile-pic">
                        </div>
                        <div class="form-group">
                            <label>Nickname</label>
                            <input type="text" id="modal-nickname">
                        </div>
                        <div class="form-group">
                            <label>Balance</label>
                            <input type="number" id="modal-balance">
                        </div>
                        <div class="form-group">
                            <label>Withdrawable Balance</label>
                            <input type="number" id="modal-withdrawable">
                        </div>
                        <div class="form-group">
                            <label>Created At</label>
                            <input type="text" id="modal-created" readonly>
                        </div>
                        <div class="form-group">
                            <label>Last Active</label>
                            <input type="text" id="modal-last-active" readonly>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="transactions-tab">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-list">
                                <!-- Transactions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="withdrawals-tab">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Method</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="withdrawals-list">
                                <!-- Withdrawals will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="investments-tab">
                        <div class="form-group">
                            <label>Quick Payout Investment</label>
                            <input type="number" id="investment-quickpayout">
                        </div>
                        <div class="form-group">
                            <label>Mobility IK Investment</label>
                            <input type="number" id="investment-mobilityik">
                        </div>
                        <div class="form-group">
                            <label>PayTM Investment</label>
                            <input type="number" id="investment-paytm">
                        </div>
                        <div class="form-group">
                            <label>PhonePe Investment</label>
                            <input type="number" id="investment-phonepe">
                        </div>
                        <div class="form-group">
                            <label>Kimi Investment</label>
                            <input type="number" id="investment-kimi">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="delete-user-btn">Delete User</button>
                    <button class="btn btn-primary" id="save-user-btn">Save Changes</button>
                </div>
            </div>
        </div>
        
        <!-- Add User Modal -->
        <div class="modal" id="add-user-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add New User</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>User ID (10 digits)</label>
                        <input type="text" id="new-user-id" placeholder="Will be generated automatically" readonly>
                    </div>
                    <div class="form-group">
                        <label>Initial Balance</label>
                        <input type="number" id="new-user-balance" value="0">
                    </div>
                    <div class="form-group">
                        <label>Initial Withdrawable Balance</label>
                        <input type="number" id="new-user-withdrawable" value="0">
                    </div>
                    <div class="form-group">
                        <label>Profile Picture URL</label>
                        <input type="text" id="new-user-pic" value="https://www.citypng.com/public/uploads/preview/hd-man-user-illustration-icon-transparent-png-701751694974843ybexneueic.png">
                    </div>
                    <div class="form-group">
                        <label>Nickname</label>
                        <input type="text" id="new-user-nickname" value="New User">
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="create-user-btn">Create User</button>
                </div>
            </div>
        </div>
        
        <!-- Deleted Users Modal -->
        <div class="modal" id="deleted-users-modal">
            <div class="modal-content" style="width: 800px;">
                <div class="modal-header">
                    <h3>Deleted Users</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Nickname</th>
                                <th>Deleted At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="deleted-users-modal-list">
                            <!-- Deleted users will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="close-deleted-users-modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

    <script>
        // Initialize Firebase with your configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAZ-znvqufe3kTB_sPxQUiOdmbjXm00D8c",
            authDomain: "customerchat-88407.firebaseapp.com",
            databaseURL: "https://customerchat-88407-default-rtdb.firebaseio.com",
            projectId: "customerchat-88407",
            storageBucket: "customerchat-88407.appspot.com",
            messagingSenderId: "1094190373370",
            appId: "1:1094190373370:web:9ef8834bb5c1d7f84c2c43"
        };

        // Initialize Firebase
        const firebaseApp = firebase.initializeApp(firebaseConfig);
        const database = firebaseApp.database();
        const auth = firebaseApp.auth();

        // Admin credentials
        const ADMIN_CREDENTIALS = {
            name: "8", // Admin username
            password: "8" // Admin password
        };

        // Global variables
        let currentPage = 1;
        const usersPerPage = 10;
        let allUsers = [];
        let currentEditingUserId = null;
        let usersRef = null;
        let statsRef = null;
        let deletedUsersRef = null;
        let allTransactions = [];
        let allWithdrawals = [];
        let deletedUsers = [];
        let charts = {};
        let analyticsInterval = null;
        let currentAnalyticsPeriod = 7;

        // DOM elements
        const loginModal = document.getElementById('login-modal');
        const loginForm = document.getElementById('login-form');
        const adminNameInput = document.getElementById('admin-name');
        const adminPasswordInput = document.getElementById('admin-password');
        const rememberMeCheckbox = document.getElementById('remember-me');
        const loginError = document.getElementById('login-error');
        const adminPanel = document.getElementById('admin-panel');
        const adminDisplayName = document.getElementById('admin-display-name');
        const logoutBtn = document.getElementById('logout-btn');
        
        // Pages
        const pages = document.querySelectorAll('.page');
        const dashboardPage = document.getElementById('dashboard-page');
        const usersPage = document.getElementById('users-page');
        const transactionsPage = document.getElementById('transactions-page');
        const withdrawalsPage = document.getElementById('withdrawals-page');
        const analyticsPage = document.getElementById('analytics-page');
        const settingsPage = document.getElementById('settings-page');
        
        // Sidebar menu links
        const menuLinks = document.querySelectorAll('.sidebar-menu a[data-page]');
        
        // Users table elements
        const usersTableBody = document.getElementById('users-table-body');
        const userModal = document.getElementById('user-modal');
        const addUserModal = document.getElementById('add-user-modal');
        const closeButtons = document.querySelectorAll('.close');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        const searchBtn = document.getElementById('search-btn');
        const userSearch = document.getElementById('user-search');
        const addUserBtn = document.getElementById('add-user-btn');
        const addUserBtnUsers = document.getElementById('add-user-btn-users');
        const createUserBtn = document.getElementById('create-user-btn');
        const saveUserBtn = document.getElementById('save-user-btn');
        const deleteUserBtn = document.getElementById('delete-user-btn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Stats elements
        const totalUsersEl = document.getElementById('total-users');
        const totalBalanceEl = document.getElementById('total-balance');
        const totalWithdrawalsEl = document.getElementById('total-withdrawals');
        const activeTodayEl = document.getElementById('active-today');
        
        // Transactions page elements
        const allTransactionsList = document.getElementById('all-transactions-list');
        const transactionSearch = document.getElementById('transaction-search');
        const transactionSearchBtn = document.getElementById('transaction-search-btn');
        const transactionsPrevPageBtn = document.getElementById('transactions-prev-page');
        const transactionsNextPageBtn = document.getElementById('transactions-next-page');
        const transactionsPageInfo = document.getElementById('transactions-page-info');
        
        // Withdrawals page elements
        const pendingWithdrawalsList = document.getElementById('pending-withdrawals-list');
        const completedWithdrawalsList = document.getElementById('completed-withdrawals-list');
        const rejectedWithdrawalsList = document.getElementById('rejected-withdrawals-list');
        const withdrawalSearch = document.getElementById('withdrawal-search');
        const withdrawalSearchBtn = document.getElementById('withdrawal-search-btn');
        const withdrawalsPrevPageBtn = document.getElementById('withdrawals-prev-page');
        const withdrawalsNextPageBtn = document.getElementById('withdrawals-next-page');
        const withdrawalsPageInfo = document.getElementById('withdrawals-page-info');
        
        // Analytics page elements
        const timePeriodButtons = document.querySelectorAll('.time-period-selector button');
        
        // Settings page elements
        const adminUsernameInput = document.getElementById('admin-username');
        const adminNewPasswordInput = document.getElementById('admin-new-password');
        const adminConfirmPasswordInput = document.getElementById('admin-confirm-password');
        const saveAdminSettingsBtn = document.getElementById('save-admin-settings');
        const deletedUsersList = document.getElementById('deleted-users-list');
        
        // Deleted users modal
        const viewDeletedBtn = document.getElementById('view-deleted-btn');
        const deletedUsersModal = document.getElementById('deleted-users-modal');
        const deletedUsersModalList = document.getElementById('deleted-users-modal-list');
        const closeDeletedUsersModalBtn = document.getElementById('close-deleted-users-modal');

        // Check if admin is already logged in (from localStorage)
        function checkAdminSession() {
            const savedCredentials = localStorage.getItem('adminCredentials');
            const lastLoginTime = localStorage.getItem('lastLoginTime');
            
            if (savedCredentials && lastLoginTime) {
                const credentials = JSON.parse(savedCredentials);
                const loginTime = parseInt(lastLoginTime);
                const currentTime = Date.now();
                const hoursSinceLogin = (currentTime - loginTime) / (1000 * 60 * 60);
                
                // Auto-login if it's been less than 24 hours since last login
                if (hoursSinceLogin < 24) {
                    ADMIN_CREDENTIALS.name = credentials.name;
                    ADMIN_CREDENTIALS.password = credentials.password;
                    
                    loginModal.style.display = 'none';
                    adminPanel.style.display = 'block';
                    adminDisplayName.textContent = ADMIN_CREDENTIALS.name;
                    initAdminPanel();
                    return true;
                } else {
                    // Clear saved credentials if it's been more than 24 hours
                    localStorage.removeItem('adminCredentials');
                    localStorage.removeItem('lastLoginTime');
                }
            }
            return false;
        }

        // Handle login form submission
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const enteredName = adminNameInput.value.trim();
            const enteredPassword = adminPasswordInput.value;
            const rememberMe = rememberMeCheckbox.checked;
            
            // Simple credential check (in a real app, use proper authentication)
            if (enteredName === ADMIN_CREDENTIALS.name && enteredPassword === ADMIN_CREDENTIALS.password) {
                // Successful login
                loginError.style.display = 'none';
                
                // Save credentials if "Remember me" is checked
                if (rememberMe) {
                    localStorage.setItem('adminCredentials', JSON.stringify({
                        name: enteredName,
                        password: enteredPassword
                    }));
                    localStorage.setItem('lastLoginTime', Date.now().toString());
                } else {
                    // Use sessionStorage for temporary login
                    sessionStorage.setItem('adminLoggedIn', 'true');
                }
                
                loginModal.style.display = 'none';
                adminPanel.style.display = 'block';
                adminDisplayName.textContent = ADMIN_CREDENTIALS.name;
                initAdminPanel();
            } else {
                // Failed login
                loginError.textContent = 'Invalid admin name or password';
                loginError.style.display = 'block';
                adminPasswordInput.value = '';
                adminPasswordInput.focus();
            }
        });

        // Handle logout
        logoutBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                // Remove all realtime listeners
                if (usersRef) usersRef.off();
                if (statsRef) statsRef.off();
                if (deletedUsersRef) deletedUsersRef.off();
                
                // Clear analytics interval
                if (analyticsInterval) {
                    clearInterval(analyticsInterval);
                    analyticsInterval = null;
                }
                
                // Destroy charts
                Object.values(charts).forEach(chart => {
                    if (chart) chart.destroy();
                });
                charts = {};
                
                // Clear all login storage
                localStorage.removeItem('adminCredentials');
                localStorage.removeItem('lastLoginTime');
                sessionStorage.removeItem('adminLoggedIn');
                
                // Reload the page
                location.reload();
            }
        });

        // Initialize admin panel
        function initAdminPanel() {
            // Set up realtime listeners
            setupRealtimeListeners();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize charts
            initCharts();
            
            // Start analytics update interval
            analyticsInterval = setInterval(updateAnalyticsData, 60000); // Update every minute
            
            // Load initial analytics data
            updateAnalyticsData();
        }

        // Set up realtime listeners
        function setupRealtimeListeners() {
            // Users data listener
            usersRef = database.ref('users');
            usersRef.on('value', (snapshot) => {
                const users = snapshot.val();
                allUsers = users ? Object.entries(users).map(([userId, userData]) => {
                    return { userId, ...userData };
                }) : [];
                
                // Sort by last active (newest first)
                allUsers.sort((a, b) => {
                    const aTime = a.lastUpdated || a.createdAt || 0;
                    const bTime = b.lastUpdated || b.createdAt || 0;
                    return bTime - aTime;
                });
                
                renderUsers();
                updateStats();
            });

            // Stats listener
            statsRef = database.ref('stats');
            statsRef.on('value', (snapshot) => {
                updateStats();
            });
            
            // Deleted users listener
            deletedUsersRef = database.ref('deletedUsers');
            deletedUsersRef.on('value', (snapshot) => {
                const deletedUsersData = snapshot.val();
                deletedUsers = deletedUsersData ? Object.entries(deletedUsersData).map(([userId, userData]) => {
                    return { userId, ...userData };
                }) : [];
                
                renderDeletedUsers();
            });
            
            // All transactions listener
            database.ref('transactions').on('value', (snapshot) => {
                const transactions = snapshot.val();
                allTransactions = transactions ? Object.entries(transactions).map(([id, tx]) => {
                    return { id, ...tx };
                }) : [];
                
                // Sort by timestamp (newest first)
                allTransactions.sort((a, b) => b.timestamp - a.timestamp);
                
                renderAllTransactions();
            });
            
            // All withdrawals listener
            database.ref('withdrawals').on('value', (snapshot) => {
                const withdrawals = snapshot.val();
                allWithdrawals = withdrawals ? Object.entries(withdrawals).map(([id, wd]) => {
                    return { id, ...wd };
                }) : [];
                
                // Sort by timestamp (newest first)
                allWithdrawals.sort((a, b) => b.timestamp - a.timestamp);
                
                renderAllWithdrawals();
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            // Sidebar menu navigation
            menuLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    
                    // Update active menu item
                    menuLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    // Show the selected page
                    pages.forEach(page => page.classList.remove('active'));
                    document.getElementById(`${pageId}-page`).classList.add('active');
                    
                    // Update header title
                    const headerTitle = document.querySelector('.header h1');
                    if (headerTitle) {
                        switch(pageId) {
                            case 'dashboard':
                                headerTitle.textContent = 'Dashboard Overview';
                                break;
                            case 'users':
                                headerTitle.textContent = 'User Management';
                                break;
                            case 'transactions':
                                headerTitle.textContent = 'Transaction Management';
                                break;
                            case 'withdrawals':
                                headerTitle.textContent = 'Withdrawal Management';
                                break;
                            case 'analytics':
                                headerTitle.textContent = 'System Analytics';
                                break;
                            case 'settings':
                                headerTitle.textContent = 'System Settings';
                                break;
                        }
                    }
                });
            });
            
            // Close buttons for modals
            closeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    userModal.style.display = 'none';
                    addUserModal.style.display = 'none';
                    deletedUsersModal.style.display = 'none';
                });
            });

            // Users pagination
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderUsers();
                }
            });

            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(allUsers.length / usersPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderUsers();
                }
            });

            // Users search
            searchBtn.addEventListener('click', searchUsers);
            userSearch.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchUsers();
            });

            // Add user buttons
            addUserBtn.addEventListener('click', showAddUserModal);
            addUserBtnUsers.addEventListener('click', showAddUserModal);
            
            function showAddUserModal() {
                // Generate random 10-digit ID
                const min = 1000000000;
                const max = 9999999999;
                const randomId = Math.floor(Math.random() * (max - min + 1)) + min;
                document.getElementById('new-user-id').value = randomId;
                addUserModal.style.display = 'flex';
            }

            createUserBtn.addEventListener('click', createNewUser);
            saveUserBtn.addEventListener('click', saveUserChanges);
            deleteUserBtn.addEventListener('click', deleteUser);

            // Tab switching in user modal
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update active content
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Load tab data if needed
                    if (tabId === 'transactions' && currentEditingUserId) {
                        loadUserTransactions(currentEditingUserId);
                    } else if (tabId === 'withdrawals' && currentEditingUserId) {
                        loadUserWithdrawals(currentEditingUserId);
                    }
                });
            });

            // Close modals when clicking outside
            window.addEventListener('click', (event) => {
                if (event.target === userModal) {
                    userModal.style.display = 'none';
                }
                if (event.target === addUserModal) {
                    addUserModal.style.display = 'none';
                }
                if (event.target === deletedUsersModal) {
                    deletedUsersModal.style.display = 'none';
                }
            });
            
            // Transactions page
            transactionSearchBtn.addEventListener('click', searchTransactions);
            transactionSearch.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchTransactions();
            });
            
            transactionsPrevPageBtn.addEventListener('click', () => {
                // Implement pagination for transactions if needed
            });
            
            transactionsNextPageBtn.addEventListener('click', () => {
                // Implement pagination for transactions if needed
            });
            
            // Withdrawals page
            withdrawalSearchBtn.addEventListener('click', searchWithdrawals);
            withdrawalSearch.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchWithdrawals();
            });
            
            withdrawalsPrevPageBtn.addEventListener('click', () => {
                // Implement pagination for withdrawals if needed
            });
            
            withdrawalsNextPageBtn.addEventListener('click', () => {
                // Implement pagination for withdrawals if needed
            });
            
            // Withdrawal tabs
            document.querySelectorAll('.withdrawals-page .tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.withdrawals-page .tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update active content
                    document.querySelectorAll('.withdrawals-page .tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Analytics period selector
            timePeriodButtons.forEach(button => {
                button.addEventListener('click', () => {
                    currentAnalyticsPeriod = parseInt(button.getAttribute('data-period'));
                    
                    // Update active button
                    timePeriodButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Update charts
                    updateAnalyticsData();
                });
            });
            
            // Settings page
            saveAdminSettingsBtn.addEventListener('click', saveAdminSettings);
            
            // View deleted users button
            viewDeletedBtn.addEventListener('click', () => {
                deletedUsersModal.style.display = 'flex';
            });
            
            closeDeletedUsersModalBtn.addEventListener('click', () => {
                deletedUsersModal.style.display = 'none';
            });
        }

        // Initialize charts
        function initCharts() {
            // Recent Activity Chart (Dashboard)
            const recentActivityCtx = document.getElementById('recent-activity-chart').getContext('2d');
            charts.recentActivity = new Chart(recentActivityCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [
                        {
                            label: 'New Users',
                            data: [12, 19, 3, 5, 2, 3, 7],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1
                        },
                        {
                            label: 'Active Users',
                            data: [8, 15, 10, 12, 9, 5, 11],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // User Growth Chart (Analytics)
            const userGrowthCtx = document.getElementById('user-growth-chart').getContext('2d');
            charts.userGrowth = new Chart(userGrowthCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Total Users',
                            data: [],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: true
                        },
                        {
                            label: 'New Users',
                            data: [],
                            borderColor: 'rgba(153, 102, 255, 1)',
                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Active Users Chart (Analytics)
            const activeUsersCtx = document.getElementById('active-users-chart').getContext('2d');
            charts.activeUsers = new Chart(activeUsersCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Active Users',
                            data: [],
                            backgroundColor: 'rgba(54, 162, 235, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Financial Chart (Analytics)
            const financialCtx = document.getElementById('financial-chart').getContext('2d');
            charts.financial = new Chart(financialCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Total Deposits',
                            data: [],
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: true
                        },
                        {
                            label: 'Total Withdrawals',
                            data: [],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Update analytics data
        function updateAnalyticsData() {
            // In a real implementation, you would fetch this data from your database
            // For now, we'll use mock data
            
            // Generate labels based on selected period
            const labels = [];
            const now = new Date();
            for (let i = currentAnalyticsPeriod; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            }
            
            // Update User Growth chart
            charts.userGrowth.data.labels = labels;
            charts.userGrowth.data.datasets[0].data = generateRandomData(currentAnalyticsPeriod + 1, 100, 200);
            charts.userGrowth.data.datasets[1].data = generateRandomData(currentAnalyticsPeriod + 1, 5, 15);
            charts.userGrowth.update();
            
            // Update Active Users chart
            charts.activeUsers.data.labels = labels;
            charts.activeUsers.data.datasets[0].data = generateRandomData(currentAnalyticsPeriod + 1, 20, 50);
            charts.activeUsers.update();
            
            // Update Financial chart
            charts.financial.data.labels = labels;
            charts.financial.data.datasets[0].data = generateRandomData(currentAnalyticsPeriod + 1, 1000, 5000);
            charts.financial.data.datasets[1].data = generateRandomData(currentAnalyticsPeriod + 1, 500, 3000);
            charts.financial.update();
            
            // Update Recent Activity chart (dashboard)
            charts.recentActivity.data.datasets[0].data = generateRandomData(7, 5, 20);
            charts.recentActivity.data.datasets[1].data = generateRandomData(7, 10, 30);
            charts.recentActivity.update();
        }
        
        // Helper function to generate random data for charts
        function generateRandomData(count, min, max) {
            return Array.from({ length: count }, () => Math.floor(Math.random() * (max - min + 1)) + min);
        }

        // Render users for current page
        function renderUsers() {
            const startIdx = (currentPage - 1) * usersPerPage;
            const endIdx = startIdx + usersPerPage;
            const usersToShow = allUsers.slice(startIdx, endIdx);
            
            usersTableBody.innerHTML = '';
            
            if (usersToShow.length === 0) {
                usersTableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No users found</td></tr>';
                return;
            }
            
            usersToShow.forEach(user => {
                const row = document.createElement('tr');
                
                // Format last active time
                const lastActiveTime = user.lastUpdated || user.createdAt;
                const lastActiveDate = lastActiveTime ? new Date(lastActiveTime) : null;
                const lastActiveStr = lastActiveDate ? 
                    `${lastActiveDate.toLocaleDateString()} ${lastActiveDate.toLocaleTimeString()}` : 
                    'Never';
                
                // Format created time
                const createdTime = user.createdAt;
                const createdDate = createdTime ? new Date(createdTime) : null;
                const createdStr = createdDate ? 
                    `${createdDate.toLocaleDateString()}` : 
                    'Unknown';
                
                // Determine if active today
                const isActiveToday = lastActiveDate && 
                    lastActiveDate.toDateString() === new Date().toDateString();
                
                row.innerHTML = `
                    <td>${user.userId}</td>
                    <td>${user.vipBadgeText || 'User'}</td>
                    <td>₹${Math.floor(user.balance || 0)}</td>
                    <td>₹${Math.floor(user.withdrawableBalance || 0)}</td>
                    <td>${lastActiveStr}</td>
                    <td>
                        <span class="badge ${isActiveToday ? 'badge-success' : 'badge-warning'}">
                            ${isActiveToday ? 'Active' : 'Inactive'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm view-user-btn" data-id="${user.userId}">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </td>
                `;
                
                usersTableBody.appendChild(row);
            });
            
            // Update pagination info
            const totalPages = Math.ceil(allUsers.length / usersPerPage);
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-user-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const userId = btn.getAttribute('data-id');
                    viewUserDetails(userId);
                });
            });
        }

        // Render deleted users
        function renderDeletedUsers() {
            deletedUsersList.innerHTML = '';
            deletedUsersModalList.innerHTML = '';
            
            if (deletedUsers.length === 0) {
                deletedUsersList.innerHTML = '<tr><td colspan="4" style="text-align: center;">No deleted users found</td></tr>';
                deletedUsersModalList.innerHTML = '<tr><td colspan="4" style="text-align: center;">No deleted users found</td></tr>';
                return;
            }
            
            deletedUsers.forEach(user => {
                const row = document.createElement('tr');
                const modalRow = document.createElement('tr');
                
                // Format deleted time
                const deletedTime = user.deletedAt;
                const deletedDate = deletedTime ? new Date(deletedTime) : null;
                const deletedStr = deletedDate ? 
                    `${deletedDate.toLocaleDateString()} ${deletedDate.toLocaleTimeString()}` : 
                    'Unknown';
                
                row.innerHTML = `
                    <td>${user.userId}</td>
                    <td>${user.vipBadgeText || 'User'}</td>
                    <td>${deletedStr}</td>
                    <td>
                        <button class="btn btn-success btn-sm restore-user-btn" data-id="${user.userId}">
                            <i class="fas fa-trash-restore"></i> Restore
                        </button>
                    </td>
                `;
                
                modalRow.innerHTML = `
                    <td>${user.userId}</td>
                    <td>${user.vipBadgeText || 'User'}</td>
                    <td>${deletedStr}</td>
                    <td>
                        <button class="btn btn-success btn-sm restore-user-btn" data-id="${user.userId}">
                            <i class="fas fa-trash-restore"></i> Restore
                        </button>
                    </td>
                `;
                
                deletedUsersList.appendChild(row);
                deletedUsersModalList.appendChild(modalRow);
            });
            
            // Add event listeners to restore buttons
            document.querySelectorAll('.restore-user-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const userId = btn.getAttribute('data-id');
                    restoreDeletedUser(userId);
                });
            });
        }

        // Render all transactions
        function renderAllTransactions() {
            allTransactionsList.innerHTML = '';
            
            if (allTransactions.length === 0) {
                allTransactionsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No transactions found</td></tr>';
                return;
            }
            
            allTransactions.slice(0, 50).forEach(tx => { // Show first 50 for performance
                const row = document.createElement('tr');
                const date = new Date(tx.timestamp);
                
                row.innerHTML = `
                    <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                    <td>${tx.userId || 'N/A'}</td>
                    <td>₹${tx.amount}</td>
                    <td>${tx.type || 'Unknown'}</td>
                    <td>${tx.description || 'No description'}</td>
                `;
                
                allTransactionsList.appendChild(row);
            });
        }

        // Render all withdrawals
        function renderAllWithdrawals() {
            pendingWithdrawalsList.innerHTML = '';
            completedWithdrawalsList.innerHTML = '';
            rejectedWithdrawalsList.innerHTML = '';
            
            if (allWithdrawals.length === 0) {
                pendingWithdrawalsList.innerHTML = '<tr><td colspan="6" style="text-align: center;">No withdrawals found</td></tr>';
                completedWithdrawalsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No completed withdrawals</td></tr>';
                rejectedWithdrawalsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No rejected withdrawals</td></tr>';
                return;
            }
            
            allWithdrawals.slice(0, 100).forEach(wd => { // Show first 100 for performance
                const row = document.createElement('tr');
                const date = new Date(wd.timestamp);
                const status = wd.status || 'pending';
                
                if (status === 'pending') {
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>${wd.userId || 'N/A'}</td>
                        <td>₹${wd.amount}</td>
                        <td>${wd.method || 'Unknown'}</td>
                        <td>${wd.accountDetails ? `${wd.accountDetails.bankName} (${wd.accountDetails.accountNumber})` : 'N/A'}</td>
                        <td>
                            <button class="btn btn-success btn-sm approve-withdrawal-btn" data-id="${wd.id}" data-user="${wd.userId}">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-danger btn-sm reject-withdrawal-btn" data-id="${wd.id}" data-user="${wd.userId}">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </td>
                    `;
                    pendingWithdrawalsList.appendChild(row);
                } else if (status === 'completed') {
                    const processedDate = wd.processedAt ? new Date(wd.processedAt) : null;
                    const processedStr = processedDate ? 
                        `${processedDate.toLocaleDateString()} ${processedDate.toLocaleTimeString()}` : 
                        'Unknown';
                    
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>${wd.userId || 'N/A'}</td>
                        <td>₹${wd.amount}</td>
                        <td>${wd.method || 'Unknown'}</td>
                        <td>${processedStr}</td>
                    `;
                    completedWithdrawalsList.appendChild(row);
                } else if (status === 'rejected') {
                    const rejectedDate = wd.processedAt ? new Date(wd.processedAt) : null;
                    const rejectedStr = rejectedDate ? 
                        `${rejectedDate.toLocaleDateString()} ${rejectedDate.toLocaleTimeString()}` : 
                        'Unknown';
                    
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>${wd.userId || 'N/A'}</td>
                        <td>₹${wd.amount}</td>
                        <td>${wd.method || 'Unknown'}</td>
                        <td>${rejectedStr}</td>
                    `;
                    rejectedWithdrawalsList.appendChild(row);
                }
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.approve-withdrawal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const withdrawalId = btn.getAttribute('data-id');
                    const userId = btn.getAttribute('data-user');
                    updateWithdrawalStatus(userId, withdrawalId, 'completed');
                });
            });
            
            document.querySelectorAll('.reject-withdrawal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const withdrawalId = btn.getAttribute('data-id');
                    const userId = btn.getAttribute('data-user');
                    updateWithdrawalStatus(userId, withdrawalId, 'rejected');
                });
            });
        }

        // Search users
        function searchUsers() {
            const searchTerm = userSearch.value.trim().toLowerCase();
            
            if (searchTerm === '') {
                // If search is empty, reload all users
                database.ref('users').once('value')
                    .then(snapshot => {
                        const users = snapshot.val();
                        allUsers = users ? Object.entries(users).map(([userId, userData]) => {
                            return { userId, ...userData };
                        }) : [];
                        
                        // Sort by last active (newest first)
                        allUsers.sort((a, b) => {
                            const aTime = a.lastUpdated || a.createdAt || 0;
                            const bTime = b.lastUpdated || b.createdAt || 0;
                            return bTime - aTime;
                        });
                        
                        currentPage = 1;
                        renderUsers();
                    });
                return;
            }
            
            // Filter existing users for real-time search
            const filteredUsers = allUsers.filter(user => {
                return (
                    user.userId.toString().includes(searchTerm) ||
                    (user.vipBadgeText && user.vipBadgeText.toLowerCase().includes(searchTerm))
                );
            });
            
            allUsers = filteredUsers;
            currentPage = 1;
            renderUsers();
        }

        // Search transactions
        function searchTransactions() {
            const searchTerm = transactionSearch.value.trim().toLowerCase();
            
            if (searchTerm === '') {
                renderAllTransactions();
                return;
            }
            
            const filteredTransactions = allTransactions.filter(tx => {
                return (
                    tx.userId.toString().includes(searchTerm) ||
                    (tx.type && tx.type.toLowerCase().includes(searchTerm)) ||
                    (tx.description && tx.description.toLowerCase().includes(searchTerm))
                );
            });
            
            allTransactionsList.innerHTML = '';
            
            if (filteredTransactions.length === 0) {
                allTransactionsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No matching transactions found</td></tr>';
                return;
            }
            
            filteredTransactions.slice(0, 50).forEach(tx => {
                const row = document.createElement('tr');
                const date = new Date(tx.timestamp);
                
                row.innerHTML = `
                    <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                    <td>${tx.userId || 'N/A'}</td>
                    <td>₹${tx.amount}</td>
                    <td>${tx.type || 'Unknown'}</td>
                    <td>${tx.description || 'No description'}</td>
                `;
                
                allTransactionsList.appendChild(row);
            });
        }

        // Search withdrawals
        function searchWithdrawals() {
            const searchTerm = withdrawalSearch.value.trim().toLowerCase();
            
            if (searchTerm === '') {
                renderAllWithdrawals();
                return;
            }
            
            const filteredWithdrawals = allWithdrawals.filter(wd => {
                return (
                    wd.userId.toString().includes(searchTerm) ||
                    (wd.method && wd.method.toLowerCase().includes(searchTerm)) ||
                    (wd.accountDetails && (
                        wd.accountDetails.bankName.toLowerCase().includes(searchTerm) ||
                        wd.accountDetails.accountNumber.includes(searchTerm)
                    )
                );
            });
            
            pendingWithdrawalsList.innerHTML = '';
            completedWithdrawalsList.innerHTML = '';
            rejectedWithdrawalsList.innerHTML = '';
            
            if (filteredWithdrawals.length === 0) {
                pendingWithdrawalsList.innerHTML = '<tr><td colspan="6" style="text-align: center;">No matching withdrawals found</td></tr>';
                completedWithdrawalsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No matching completed withdrawals</td></tr>';
                rejectedWithdrawalsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No matching rejected withdrawals</td></tr>';
                return;
            }
            
            filteredWithdrawals.slice(0, 100).forEach(wd => {
                const row = document.createElement('tr');
                const date = new Date(wd.timestamp);
                const status = wd.status || 'pending';
                
                if (status === 'pending') {
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>${wd.userId || 'N/A'}</td>
                        <td>₹${wd.amount}</td>
                        <td>${wd.method || 'Unknown'}</td>
                        <td>${wd.accountDetails ? `${wd.accountDetails.bankName} (${wd.accountDetails.accountNumber})` : 'N/A'}</td>
                        <td>
                            <button class="btn btn-success btn-sm approve-withdrawal-btn" data-id="${wd.id}" data-user="${wd.userId}">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-danger btn-sm reject-withdrawal-btn" data-id="${wd.id}" data-user="${wd.userId}">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </td>
                    `;
                    pendingWithdrawalsList.appendChild(row);
                } else if (status === 'completed') {
                    const processedDate = wd.processedAt ? new Date(wd.processedAt) : null;
                    const processedStr = processedDate ? 
                        `${processedDate.toLocaleDateString()} ${processedDate.toLocaleTimeString()}` : 
                        'Unknown';
                    
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>${wd.userId || 'N/A'}</td>
                        <td>₹${wd.amount}</td>
                        <td>${wd.method || 'Unknown'}</td>
                        <td>${processedStr}</td>
                    `;
                    completedWithdrawalsList.appendChild(row);
                } else if (status === 'rejected') {
                    const rejectedDate = wd.processedAt ? new Date(wd.processedAt) : null;
                    const rejectedStr = rejectedDate ? 
                        `${rejectedDate.toLocaleDateString()} ${rejectedDate.toLocaleTimeString()}` : 
                        'Unknown';
                    
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>${wd.userId || 'N/A'}</td>
                        <td>₹${wd.amount}</td>
                        <td>${wd.method || 'Unknown'}</td>
                        <td>${rejectedStr}</td>
                    `;
                    rejectedWithdrawalsList.appendChild(row);
                }
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.approve-withdrawal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const withdrawalId = btn.getAttribute('data-id');
                    const userId = btn.getAttribute('data-user');
                    updateWithdrawalStatus(userId, withdrawalId, 'completed');
                });
            });
            
            document.querySelectorAll('.reject-withdrawal-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const withdrawalId = btn.getAttribute('data-id');
                    const userId = btn.getAttribute('data-user');
                    updateWithdrawalStatus(userId, withdrawalId, 'rejected');
                });
            });
        }

        // View user details
        function viewUserDetails(userId) {
            currentEditingUserId = userId;
            
            // Set up realtime listener for this user
            database.ref(`users/${userId}`).on('value', (snapshot) => {
                const user = snapshot.val();
                if (!user) {
                    alert('User not found!');
                    return;
                }
                
                // Populate basic info
                document.getElementById('modal-user-id').value = userId;
                document.getElementById('modal-profile-pic').value = user.profilePic || '';
                document.getElementById('modal-nickname').value = user.vipBadgeText || '';
                document.getElementById('modal-balance').value = user.balance || 0;
                document.getElementById('modal-withdrawable').value = user.withdrawableBalance || 0;
                
                // Format dates
                const createdTime = user.createdAt;
                const createdDate = createdTime ? new Date(createdTime) : null;
                const createdStr = createdDate ? 
                    `${createdDate.toLocaleDateString()} ${createdDate.toLocaleTimeString()}` : 
                    'Unknown';
                
                const lastActiveTime = user.lastUpdated;
                const lastActiveDate = lastActiveTime ? new Date(lastActiveTime) : null;
                const lastActiveStr = lastActiveDate ? 
                    `${lastActiveDate.toLocaleDateString()} ${lastActiveDate.toLocaleTimeString()}` : 
                    'Never';
                
                // Add last update info display
                const lastUpdateTime = user.lastUpdateTime ? new Date(user.lastUpdateTime) : null;
                const lastUpdateStr = lastUpdateTime ? 
                    `${lastUpdateTime.toLocaleString()} (${user.lastUpdatedBy || 'user'})` : 
                    'Unknown';
                
                document.getElementById('modal-created').value = createdStr;
                document.getElementById('modal-last-active').value = lastActiveStr;
                
                // Populate investments if they exist
                if (user.investments) {
                    document.getElementById('investment-quickpayout').value = user.investments.quickpayout?.amount || 0;
                    document.getElementById('investment-mobilityik').value = user.investments.mobilityik?.amount || 0;
                    document.getElementById('investment-paytm').value = user.investments.paytm?.amount || 0;
                    document.getElementById('investment-phonepe').value = user.investments.phonepe?.amount || 0;
                    document.getElementById('investment-kimi').value = user.investments.kimi?.amount || 0;
                }
                
                // Load transactions and withdrawals
                loadUserTransactions(userId);
                loadUserWithdrawals(userId);
            });
            
            // Show modal
            userModal.style.display = 'flex';
            
            // Remove listener when modal is closed
            document.querySelector('.close.user-modal').addEventListener('click', () => {
                database.ref(`users/${userId}`).off();
            });
        }

        // Load user transactions
        function loadUserTransactions(userId) {
            const transactionsList = document.getElementById('transactions-list');
            transactionsList.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading...</td></tr>';
            
            // Set up realtime listener for transactions
            database.ref(`users/${userId}/transactions`).on('value', (snapshot) => {
                const transactions = snapshot.val();
                transactionsList.innerHTML = '';
                
                if (!transactions || Object.keys(transactions).length === 0) {
                    transactionsList.innerHTML = '<tr><td colspan="4" style="text-align: center;">No transactions found</td></tr>';
                    return;
                }
                
                // Sort by timestamp (newest first)
                const sortedTransactions = Object.entries(transactions)
                    .map(([id, tx]) => ({ id, ...tx }))
                    .sort((a, b) => b.timestamp - a.timestamp);
                
                sortedTransactions.forEach(tx => {
                    const row = document.createElement('tr');
                    const date = new Date(tx.timestamp);
                    
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>₹${tx.amount}</td>
                        <td>${tx.type || 'Unknown'}</td>
                        <td>${tx.description || 'No description'}</td>
                    `;
                    
                    transactionsList.appendChild(row);
                });
            });
        }

        // Load user withdrawals
        function loadUserWithdrawals(userId) {
            const withdrawalsList = document.getElementById('withdrawals-list');
            withdrawalsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">Loading...</td></tr>';
            
            // Set up realtime listener for withdrawals
            database.ref(`users/${userId}/withdrawals`).on('value', (snapshot) => {
                const withdrawals = snapshot.val();
                withdrawalsList.innerHTML = '';
                
                if (!withdrawals || Object.keys(withdrawals).length === 0) {
                    withdrawalsList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No withdrawals found</td></tr>';
                    return;
                }
                
                // Sort by timestamp (newest first)
                const sortedWithdrawals = Object.entries(withdrawals)
                    .map(([id, wd]) => ({ id, ...wd }))
                    .sort((a, b) => b.timestamp - a.timestamp);
                
                sortedWithdrawals.forEach(wd => {
                    const row = document.createElement('tr');
                    const date = new Date(wd.timestamp);
                    const status = wd.status || 'pending';
                    
                    row.innerHTML = `
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString()}</td>
                        <td>₹${wd.amount}</td>
                        <td>
                            <span class="badge ${
                                status === 'completed' ? 'badge-success' : 
                                status === 'rejected' ? 'badge-danger' : 'badge-warning'
                            }">
                                ${status}
                            </span>
                        </td>
                        <td>${wd.method || 'Unknown'}</td>
                        <td>
                            ${status === 'pending' ? `
                                <button class="btn btn-success btn-sm approve-withdrawal-btn" data-id="${wd.id}">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-danger btn-sm reject-withdrawal-btn" data-id="${wd.id}">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                        </td>
                    `;
                    
                    withdrawalsList.appendChild(row);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('.approve-withdrawal-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const withdrawalId = btn.getAttribute('data-id');
                        updateWithdrawalStatus(userId, withdrawalId, 'completed');
                    });
                });
                
                document.querySelectorAll('.reject-withdrawal-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const withdrawalId = btn.getAttribute('data-id');
                        updateWithdrawalStatus(userId, withdrawalId, 'rejected');
                    });
                });
            });
        }

        // Update withdrawal status
        function updateWithdrawalStatus(userId, withdrawalId, status) {
            if (!confirm(`Are you sure you want to ${status} this withdrawal?`)) return;
            
            const updates = {
                status: status,
                processedAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            database.ref(`users/${userId}/withdrawals/${withdrawalId}`).update(updates)
                .then(() => {
                    // Also update the global withdrawals reference
                    database.ref(`withdrawals/${withdrawalId}`).update(updates)
                        .then(() => {
                            // Force refresh of user data
                            database.ref(`users/${userId}/forceUpdate`).set(Date.now());
                        });
                })
                .catch(error => {
                    console.error("Error updating withdrawal:", error);
                    alert("Failed to update withdrawal status.");
                });
        }

        // Save user changes
        function saveUserChanges() {
            if (!currentEditingUserId) return;
            
            const updates = {
                profilePic: document.getElementById('modal-profile-pic').value,
                vipBadgeText: document.getElementById('modal-nickname').value,
                balance: parseFloat(document.getElementById('modal-balance').value) || 0,
                withdrawableBalance: parseFloat(document.getElementById('modal-withdrawable').value) || 0,
                lastUpdated: firebase.database.ServerValue.TIMESTAMP,
                lastUpdatedBy: 'admin',
                lastUpdateTime: Date.now()
            };
            
            // Add investments updates if needed
            updates.investments = {
                quickpayout: { amount: parseFloat(document.getElementById('investment-quickpayout').value) || 0 },
                mobilityik: { amount: parseFloat(document.getElementById('investment-mobilityik').value) || 0 },
                paytm: { amount: parseFloat(document.getElementById('investment-paytm').value) || 0 },
                phonepe: { amount: parseFloat(document.getElementById('investment-phonepe').value) || 0 },
                kimi: { amount: parseFloat(document.getElementById('investment-kimi').value) || 0 }
            };
            
            database.ref(`users/${currentEditingUserId}`).update(updates)
                .then(() => {
                    // Force update to trigger all listeners
                    database.ref(`users/${currentEditingUserId}/forceUpdate`).set(Date.now())
                        .then(() => {
                            alert('User updated successfully!');
                        });
                })
                .catch(error => {
                    console.error("Error updating user:", error);
                    alert("Failed to update user.");
                });
        }

        // Delete user
        function deleteUser() {
            if (!currentEditingUserId || !confirm('Are you sure you want to delete this user?')) {
                return;
            }
            
            // First get the user data
            database.ref(`users/${currentEditingUserId}`).once('value')
                .then(snapshot => {
                    const userData = snapshot.val();
                    if (!userData) {
                        alert('User not found!');
                        return;
                    }
                    
                    // Add deletion timestamp
                    userData.deletedAt = firebase.database.ServerValue.TIMESTAMP;
                    
                    // Save to deleted users
                    return database.ref(`deletedUsers/${currentEditingUserId}`).set(userData);
                })
                .then(() => {
                    // Now remove from active users
                    return database.ref(`users/${currentEditingUserId}`).remove();
                })
                .then(() => {
                    alert('User deleted successfully!');
                    userModal.style.display = 'none';
                })
                .catch(error => {
                    console.error("Error deleting user:", error);
                    alert("Failed to delete user.");
                });
        }

        // Restore deleted user
        function restoreDeletedUser(userId) {
            if (!confirm('Are you sure you want to restore this user?')) return;
            
            // First get the deleted user data
            database.ref(`deletedUsers/${userId}`).once('value')
                .then(snapshot => {
                    const userData = snapshot.val();
                    if (!userData) {
                        alert('User not found in deleted records!');
                        return;
                    }
                    
                    // Remove deletedAt field
                    delete userData.deletedAt;
                    
                    // Restore to active users
                    return database.ref(`users/${userId}`).set(userData);
                })
                .then(() => {
                    // Now remove from deleted users
                    return database.ref(`deletedUsers/${userId}`).remove();
                })
                .then(() => {
                    alert('User restored successfully!');
                })
                .catch(error => {
                    console.error("Error restoring user:", error);
                    alert("Failed to restore user.");
                });
        }

        // Create new user
        function createNewUser() {
            const userId = document.getElementById('new-user-id').value;
            const balance = parseFloat(document.getElementById('new-user-balance').value) || 0;
            const withdrawable = parseFloat(document.getElementById('new-user-withdrawable').value) || 0;
            const profilePic = document.getElementById('new-user-pic').value;
            const nickname = document.getElementById('new-user-nickname').value;
            
            if (!userId || userId.length !== 10) {
                alert('User ID must be 10 digits!');
                return;
            }
            
            const newUser = {
                userId,
                balance,
                withdrawableBalance: withdrawable,
                profilePic,
                vipBadgeText: nickname,
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                lastUpdated: firebase.database.ServerValue.TIMESTAMP,
                investments: {
                    quickpayout: { amount: 0, earnings: 0 },
                    mobilityik: { amount: 0, earnings: 0 },
                    paytm: { amount: 0, earnings: 0 },
                    phonepe: { amount: 0, earnings: 0 },
                    kimi: { amount: 0, earnings: 0 }
                },
                redeemedCodes: {},
                transactions: {},
                savedBankDetails: {},
                withdrawals: {},
                lastDailyReferral: null
            };
            
            database.ref(`users/${userId}`).set(newUser)
                .then(() => {
                    alert('User created successfully!');
                    addUserModal.style.display = 'none';
                })
                .catch(error => {
                    console.error("Error creating user:", error);
                    alert("Failed to create user. It might already exist.");
                });
        }

        // Save admin settings
        function saveAdminSettings() {
            const newUsername = adminUsernameInput.value.trim();
            const newPassword = adminNewPasswordInput.value;
            const confirmPassword = adminConfirmPasswordInput.value;
            
            if (newUsername === '') {
                alert('Username cannot be empty!');
                return;
            }
            
            if (newPassword !== '' && newPassword !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            // Update the admin credentials
            ADMIN_CREDENTIALS.name = newUsername;
            if (newPassword !== '') {
                ADMIN_CREDENTIALS.password = newPassword;
                
                // Update saved credentials if they exist
                const savedCredentials = localStorage.getItem('adminCredentials');
                if (savedCredentials) {
                    const credentials = JSON.parse(savedCredentials);
                    credentials.password = newPassword;
                    localStorage.setItem('adminCredentials', JSON.stringify(credentials));
                }
            }
            
            // Update display name
            adminDisplayName.textContent = newUsername;
            document.getElementById('admin-display-name-users').textContent = newUsername;
            
            // Clear password fields
            adminNewPasswordInput.value = '';
            adminConfirmPasswordInput.value = '';
            
            alert('Admin settings updated successfully!');
        }

        // Update statistics
        function updateStats() {
            let totalUsers = 0;
            let totalBalance = 0;
            let totalWithdrawals = 0;
            let activeToday = 0;
            const today = new Date().toDateString();
            
            allUsers.forEach(user => {
                totalUsers++;
                totalBalance += user.balance || 0;
                
                // Calculate total withdrawals
                if (user.withdrawals) {
                    Object.values(user.withdrawals).forEach(wd => {
                        if (wd.status === 'completed') {
                            totalWithdrawals += wd.amount || 0;
                        }
                    });
                }
                
                // Check if active today
                const lastActiveTime = user.lastUpdated;
                if (lastActiveTime) {
                    const lastActiveDate = new Date(lastActiveTime).toDateString();
                    if (lastActiveDate === today) {
                        activeToday++;
                    }
                }
            });
            
            // Update stats display
            totalUsersEl.textContent = totalUsers;
            totalBalanceEl.textContent = `₹${Math.floor(totalBalance)}`;
            totalWithdrawalsEl.textContent = `₹${Math.floor(totalWithdrawals)}`;
            activeTodayEl.textContent = activeToday;
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // First try to auto-login with saved credentials
            const isAutoLoggedIn = checkAdminSession();
            
            if (!isAutoLoggedIn) {
                // Show login modal if auto-login failed
                loginModal.style.display = 'flex';
                adminPanel.style.display = 'none';
                
                // Focus on username input when modal is shown
                adminNameInput.focus();
            }
        });
    </script>
</body>
</html>